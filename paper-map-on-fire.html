<link rel="import" href="../firebase-element/firebase-element.html">
<link rel="import" href="../paper-cards-on-fire/paper-cards-on-fire.html">
<link rel="import" href="../url-value/url-value.html">
<link rel="import" href="../paper-filter-on-fire/paper-filter-on-fire.html">
<link rel="import" href="map-on-fire.html">

<polymer-element id="paperMapOnFire" name="paper-map-on-fire" attributes="url location">
<template>
<link rel="stylesheet" href="paper-map-on-fire.css">

<url-value values="{{urlValues}}"></url-value>

<firebase-element location="{{url}}" data="{{data}}" keys="{{keys}}" id="paperMapOnFireBase"></firebase-element>
<div>
  <div id="filters">
    <paper-filter-on-fire show="{{cards}}" data="{{data}}" keys="{{pins}}" filters="{{filters}}" by="facilities" filteredKeys="{{facilitiesFilteredKeys}}"></paper-filter-on-fire>

  </div>
    <div id="map_space" style="height:400px"> 
      <map-filter pins="{{pins}}"  show="{{cards}}" location="{{location}}" data="{{data}}" keys="{{keys}}" filteredKeys="{{mapFilteredKeys}}"></map-filter>
  </div> 
  <div id="cards">
    <paper-cards-on-fire data="{{data}}" keys="{{cards}}" ></paper-cards-on-fire>
  </div>
</div>
</template>
<script>
  Polymer("paper-map-on-fire",{
    publish: {
      cards: {},
      facilitiesFilteredKeys:[], 
      mapFilteredKeys: {},
      keys: {},
      urlValues:{} 
    },
    inBoth: function(a,b) {
      output =[];
      if ((a.length === false || a.length === undefined) && (b.length === false || b.length === undefined)) {
        return [];
      } else if (b.length === false || b.length === undefined) {
        return a;
      } else if (a.length === false || a.length === undefined) {
        return b;
      };
      if (a.length > b.length) {
        for (var x in b) {
          if (b.indexOf(x)) {
            output.push(x);
          }
        }
        } else {
        for (var x in a) {
          if (a.indexOf(x)) {
            output.push(a[x]);
          }
        }
      }
      return output;
    },
    cards:[],
    keysChanged: function(oldValue, newValue) {
      //this.cards = newValue;
      this.cards = this.inBoth(this.mapFilteredKeys,this.facilitiesFilteredKeys);
    },
    urlValuesChanged: function(oldValue, newValue) {
    },
    mapFilteredKeysChanged: function(oldValue, newValue) {
      this.cards = this.inBoth(newValue,this.facilitiesFilteredKeys);
    },
    facilitiesFilteredKeysChanged: function(oldValue, newValue) {
      this.cards = this.inBoth(newValue,this.mapFilteredKeys);
    },
    ready: function() { console.log('paper ready');
    }
  });
</script>
</polymer-element>
