<link rel="import" href="../firebase-element/firebase-element.html">
<link rel="import" href="../paper-cards-on-fire/paper-cards-on-fire.html">
<link rel="import" href="../paper-filter-on-fire/paper-filter-on-fire.html">
<link rel="import" href="map-on-fire.html">

<polymer-element id="paperMapOnFire" name="paper-map-on-fire" attributes="url location">
<template>
<link rel="stylesheet" href="paper-map-on-fire.css">

<!-- Firebase Element -->
<firebase-element location="{{url}}" data="{{data}}" keys="{{keys}}" id="paperMapOnFireBase"></firebase-element>
<div>
  <div id="map_space"> 
    <map-filter location="{{location}}" data="{{data}}" keys="{{keysForMap}}" filteredKeys="{{mapFilteredKeys}}"></map-filter>
  </div> 
  <div id="filters">
    <paper-filter-on-fire show="{{cards}}" data="{{data}}" keys="{{keysForFilter}}" filters="{{filters}}" by="facilities" filteredKeys="{{facilitiesFilteredKeys}}"></paper-filter-on-fire>

  </div>
  <div id="cards">
    {{data[facilitiesFilteredKeys[0]].title}}
    <paper-cards-on-fire data="{{data}}" keys="{{cards}}" ></paper-cards-on-fire>
  </div>
</div>
</template>
<script>
  Polymer("paper-map-on-fire",{
    publish: {
      cards: [],
      facilitiesFilteredKeys: [],
      mapFilteredKeys: [],
      keys: [],
    },
    inBoth: function(a,b) {
      output =[];
      if (a === undefined || a.length === 0) {
        return b;
      };
      if (b === undefined || b.length === 0) {
        return a;
      };
      if (a.length > b.length) {
        for (var x in b) {
          if (b.indexOf(x)) {
            output.push(x);
          }
        }
        } else {
        for (var x in a) {
          if (a.indexOf(x)) {
            output.push(x);
          }
        }
      }
      debugger;
      return output;
    },
    cards:[],
    keysChanged: function(oldValue, newValue) {
      debugger;
      this.keysForFilter = newValue;  
      this.keysForMap = newValue;  
      //this.cards = newValue;
    },
    mapFilteredKeysChanged: function(oldValue, newValue) {
      debugger;
      // this.cards = this.inBoth(newValue,this.facilitiesFilteredKeys);  
      this.cards = newValue;  
    },
    facilitiesFilteredKeysChanged: function(oldValue, newValue) {
      debugger;
      // this.cards = this.inBoth(newValue,this.mapFilteredKeys);  
      this.cards = newValue;  
    },
    ready: function() { console.log('paper ready');
    }
  });
</script>
</polymer-element>
